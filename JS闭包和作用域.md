##### 什么是闭包

闭包就是指有权访问另一个函数作用域中的变量的函数。

##### 什么是作用域

作用域是一个变量和函数的作用范围，JS中函数内声明的所有变量在函数体内始终是可见的，在ES6前有全局作用域和局部作用域，但是没有块级作用域（catch只在其内部生效），局部变量的优先级高于全局变量。

##### 作用域链

JavaScrit中有一个执行上下文（execution context）的概念,它定义了变量或函数有权访问的其它数据，决定了他们各自的行为。每个执行环境都有一个与之关联的变量对象，环境中定义的所有变量和函数都保存在这个对象中。

当访问一个变量时，解释器会首先在当前作用域查找标示符，如果没有找到，就去父作用域找，直到找到该变量的标示符或者不在父作用域中，这就是作用域链。

作用域链和原型继承查找是的区别：如果去查找一个普通对象的属性，但是在当前对象和其原型中都找不到时，会返回undefined；但查找的属性在作用域链中不存在的话就会抛出ReferenceError。

作用域链的顶端是全局对象，在全局环境中定义的变量就会绑定到全局对象中。

闭包的作用域链包含着它自己的作用域，以及包含它的函数的作用域和全局作用域。

##### 闭包的特性

1. 函数嵌套函数
2. 内部函数可以访问外部作用域（或外部函数）的变量和参数
3. 参数和变量不会被回收机制回收，一直存在于内存中，除非手动清除

##### 为什么要用闭包

1. 希望变量长期存在内存中
2. 避免全局变量污染

###### JavaScript中的函数运行在它们被定义的作用域里，而不是它们被执行的作用域里。--<<JavaScript权威指南>>

var name = 'Jane';

function getName(){

  console.log(name);

}

function myName(){

   var name = 'haha';

   getName();

}

myName();//Jane

##### 闭包的缺陷

闭包的缺点就是常驻内存会增大内存使用量，并且使用不当很容易造成内存泄漏。

如果不是因为某些特殊任务而需要闭包，在没有必要的情况下，在其他函数中创建函数式不明智的，因为闭包对脚本性能具有负面影响，包括处理速度和内存消耗。

https://juejin.im/post/5d7864e46fb9a06b051818e8

总结：

闭包是函数在特定情况下执行产生的一种现象，这种现象产生的条件为：当一个函数（outer）运行时它的形参或者它的局部变量被其他函数所引用。满足这个条件时，那么这个outer就会形成闭包，这个闭包所包含的变量为outer本身运行时被其他函数引用到的所有形参和局部变量。形参和变量被引用的方式可以是内部直接运行（包括自执行匿名函数）、被赋值给外部变量、或者是被return。

##### 闭包的应用

1）在循环中找到正确的索引

2）模块化开发

3）柯里化

##### 内存泄漏

- 意外的全局变量：无法被回收
- 定时器：未被正确关闭，导致所引用的外部变量无法被释放
- 事件监听：没有正确销毁（低版本浏览器可能出现）
- 闭包：会导致父级中的变量无法被释放
- dom引用：dom元素被删除时，内存中的引用未被正确清空

可用chrome中的timeline进行内存标记，可视化查看内存的变化情况，找出异常点。
